{% extends 'base.html' %}

{% block title %}Register - Hotel Management System{% endblock %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

    body {
        font-family: 'Inter', sans-serif !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    /* Animated background particles */
    body::before {
        content: '';
        position: absolute;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        border-radius: 50%;
        top: -250px;
        right: -250px;
        animation: float 20s infinite ease-in-out;
    }

    body::after {
        content: '';
        position: absolute;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, transparent 70%);
        border-radius: 50%;
        bottom: -200px;
        left: -200px;
        animation: float 15s infinite ease-in-out reverse;
    }

    @keyframes float {

        0%,
        100% {
            transform: translate(0, 0) scale(1);
        }

        50% {
            transform: translate(30px, 30px) scale(1.1);
        }
    }

    .auth-container-register {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow:
            0 20px 60px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(255, 255, 255, 0.1);
        padding: 48px;
        width: 100%;
        max-width: 520px;
        margin: 40px auto;
        position: relative;
        animation: fadeInUp 0.6s ease-out;
        z-index: 1;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .logo-container-register {
        text-align: center;
        margin-bottom: 32px;
    }

    .logo-icon-register {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        display: inline-flex;
        align-items: center;
        justify-center;
        margin-bottom: 16px;
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    .register-title {
        font-size: 32px;
        font-weight: 800;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
    }

    .register-subtitle {
        color: #6b7280;
        font-size: 15px;
        font-weight: 500;
    }

    .input-group-register {
        position: relative;
        margin-bottom: 18px;
    }

    .input-icon-register {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        transition: color 0.3s;
        pointer-events: none;
        z-index: 1;
    }

    .form-input-register {
        width: 100%;
        padding: 14px 16px 14px 48px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 500;
        transition: all 0.3s;
        background: white;
    }

    .form-input-register:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .form-input-register:focus+.input-icon-register {
        color: #667eea;
    }

    /* Password strength indicator */
    .password-strength {
        margin-top: 8px;
        margin-bottom: 12px;
    }

    .strength-bar-container {
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 6px;
    }

    .strength-bar {
        height: 100%;
        width: 0%;
        transition: all 0.3s;
        border-radius: 3px;
    }

    .strength-text {
        font-size: 12px;
        font-weight: 600;
        text-align: right;
    }

    .strength-weak {
        background: #ef4444;
    }

    .strength-medium {
        background: #f59e0b;
    }

    .strength-strong {
        background: #10b981;
    }

    .btn-primary-register {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        position: relative;
        overflow: hidden;
        margin-top: 8px;
    }

    .btn-primary-register::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .btn-primary-register:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
    }

    .btn-primary-register:hover::before {
        left: 100%;
    }

    .btn-primary-register:active {
        transform: translateY(0);
    }

    .btn-primary-register:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }

    .alert-register {
        padding: 16px 20px;
        border-radius: 12px;
        margin-top: 20px;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        animation: slideInDown 0.4s ease-out;
    }

    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .alert-error-register {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #991b1b;
        border: 2px solid #fca5a5;
    }

    .alert-success-register {
        background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        color: #166534;
        border: 2px solid #86efac;
    }

    .alert-register svg {
        width: 20px;
        height: 20px;
        margin-right: 12px;
        flex-shrink: 0;
    }

    .signin-link {
        text-align: center;
        margin-top: 24px;
        color: #6b7280;
        font-size: 15px;
    }

    .signin-link a {
        color: #667eea;
        font-weight: 700;
        text-decoration: none;
        transition: color 0.3s;
    }

    .signin-link a:hover {
        color: #764ba2;
    }

    .spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.6s linear infinite;
        margin-right: 8px;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
</style>

<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="auth-container-register">
        <div class="logo-container-register">
            <div class="logo-icon-register">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
            <h1 class="register-title">Create Account</h1>
            <p class="register-subtitle">Join our Hotel Management System</p>
        </div>

        <form id="register-form">
            <div class="input-group-register">
                <input id="username" name="username" type="text" required class="form-input-register"
                    placeholder="Username">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>

            <div class="input-group-register">
                <input id="email-address" name="email" type="email" autocomplete="email" required
                    class="form-input-register" placeholder="Email address">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
            </div>

            <div class="input-group-register">
                <input id="first-name" name="first_name" type="text" required class="form-input-register"
                    placeholder="First Name">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>

            <div class="input-group-register">
                <input id="last-name" name="last_name" type="text" required class="form-input-register"
                    placeholder="Last Name">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>

            <div class="input-group-register">
                <input id="phone-number" name="phone_number" type="tel" class="form-input-register"
                    placeholder="Phone Number (optional)">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path
                        d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                    </path>
                </svg>
            </div>

            <div class="input-group-register">
                <input id="password" name="password" type="password" autocomplete="new-password" required
                    class="form-input-register" placeholder="Password">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>

            <div class="password-strength" id="password-strength" style="display: none;">
                <div class="strength-bar-container">
                    <div class="strength-bar" id="strength-bar"></div>
                </div>
                <div class="strength-text" id="strength-text"></div>
            </div>

            <div class="input-group-register">
                <input id="password-confirm" name="password_confirm" type="password" autocomplete="new-password"
                    required class="form-input-register" placeholder="Confirm Password">
                <svg class="input-icon-register" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>

            <button type="submit" class="btn-primary-register" id="register-btn">
                Create Account
            </button>
        </form>

        <div id="register-error" class="alert-register alert-error-register hidden">
            <svg viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                    clip-rule="evenodd" />
            </svg>
            <span id="error-text-register"></span>
        </div>

        <div id="register-success" class="alert-register alert-success-register hidden">
            <svg viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd" />
            </svg>
            <span>Registration successful! Redirecting to login...</span>
        </div>

        <div class="signin-link">
            Already have an account? <a href="/accounts/login/">Sign in</a>
        </div>
    </div>
</div>

<script>
    // Password strength checker
    const passwordInput = document.getElementById('password');
    const strengthContainer = document.getElementById('password-strength');
    const strengthBar = document.getElementById('strength-bar');
    const strengthText = document.getElementById('strength-text');

    passwordInput.addEventListener('input', function () {
        const password = this.value;

        if (password.length === 0) {
            strengthContainer.style.display = 'none';
            return;
        }

        strengthContainer.style.display = 'block';
        const strength = calculatePasswordStrength(password);

        strengthBar.style.width = strength.percent + '%';
        strengthBar.className = 'strength-bar ' + strength.class;
        strengthText.textContent = strength.text;
        strengthText.style.color = strength.color;
    });

    function calculatePasswordStrength(password) {
        let score = 0;

        if (password.length >= 8) score += 25;
        if (password.length >= 12) score += 15;
        if (/[a-z]/.test(password)) score += 15;
        if (/[A-Z]/.test(password)) score += 15;
        if (/[0-9]/.test(password)) score += 15;
        if (/[^a-zA-Z0-9]/.test(password)) score += 15;

        if (score <= 40) {
            return { percent: 33, class: 'strength-weak', text: 'Weak', color: '#ef4444' };
        } else if (score <= 70) {
            return { percent: 66, class: 'strength-medium', text: 'Medium', color: '#f59e0b' };
        } else {
            return { percent: 100, class: 'strength-strong', text: 'Strong', color: '#10b981' };
        }
    }

    // Form submission
    document.getElementById('register-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = {
            username: document.getElementById('username').value,
            email: document.getElementById('email-address').value,
            first_name: document.getElementById('first-name').value,
            last_name: document.getElementById('last-name').value,
            phone_number: document.getElementById('phone-number').value,
            password: document.getElementById('password').value,
            password_confirm: document.getElementById('password-confirm').value
        };

        const errorDiv = document.getElementById('register-error');
        const errorText = document.getElementById('error-text-register');
        const successDiv = document.getElementById('register-success');
        const submitBtn = document.getElementById('register-btn');

        errorDiv.classList.add('hidden');
        successDiv.classList.add('hidden');

        // Validate required fields
        if (!formData.username || !formData.email || !formData.first_name || !formData.last_name || !formData.password || !formData.password_confirm) {
            showError('All required fields must be filled.');
            return;
        }

        // Validate passwords match
        if (formData.password !== formData.password_confirm) {
            showError('Passwords do not match');
            return;
        }

        // Validate password strength
        if (formData.password.length < 8) {
            showError('Password must be at least 8 characters long');
            return;
        }

        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner"></span>Creating account...';

        // Send registration request
        fetch('/accounts/register/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        })
            .then(response => response.json())
            .then(data => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Create Account';

                if (data.user) {
                    successDiv.classList.remove('hidden');
                    setTimeout(() => {
                        window.location.href = '/login/?registered=true';
                    }, 2000);
                } else if (data.email) {
                    showError(data.email[0]);
                } else if (data.username) {
                    showError(data.username[0]);
                } else if (data.password) {
                    showError(data.password[0]);
                } else if (data.detail) {
                    showError(data.detail);
                } else {
                    showError('Registration failed. Please try again.');
                }
            })
            .catch(error => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Create Account';
                console.error('Registration error:', error);
                showError('An error occurred during registration. Please try again.');
            });
    });

    function showError(message) {
        const errorDiv = document.getElementById('register-error');
        const errorText = document.getElementById('error-text-register');

        if (errorDiv && errorText) {
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');

            setTimeout(function () {
                errorDiv.classList.add('hidden');
            }, 5000);
        }
    }
</script>
{% endblock %}